<?php
// V2RAY
/bin/bash /etc/bnetscripts/liberarcuentasv2ray.sh > /dev/null 2>&1
/bin/bash /etc/bnetscripts/eliminarv2ray.sh > /dev/null 2>&1
/bin/bash /etc/bnetscripts/actualizarv2ray.sh > /dev/null 2>&1

// SCRIPTS
apt-get install dos2unix -y
dos2unix .sh

dos2unix limpieza.sh

// WS
HTTP/1.1 101 Web Socket Protocol Handshake\r\nConnection: Upgrade\r\nUpgrade: websocket\r\n\r\nHTTP/1.1 200 Connection Established\r\n\r\n

// MANTENIMIENTO
rm ws.py
wget https://bnetservice.com.mx/bNetService/root/ws.py --no-check-certificate
chmod +x ws.py
rm websocket.sh
wget https://bnetservice.com.mx/bNetService/root/websocket.sh --no-check-certificate
dos2unix websocket.sh
chmod +x websocket.sh

nano /etc/rc.local
python /root/ws.py &
nano /etc/stunnel/stunnel.conf

nano sslr.sh
#!/bin/bash
service stunnel4 restart > /dev/null 2>&1
exit 0
dos2unix sslr.sh
nano /etc/crontab
* */3	* * *	root	/bin/bash /root/sslr.sh > /dev/null 2>&1
systemctl restart cron

/bin/bash /etc/bnetscripts/actidserver.sh > /dev/null 2>&1
/*
rm -r /var/log/journal/*
rm -r /var/log/v2ray/*
rm -r /var/cache/*
rm -r /var/log/v2ray/*
rm -r ./.cache/*
*/

sync; echo 1 > /proc/sys/vm/drop_caches
sync; echo 2 > /proc/sys/vm/drop_caches
sync; echo 3 > /proc/sys/vm/drop_caches
swapoff -a && swapon -a

rm /var/log/syslog
rm /var/log/syslog.1
cd /var/log
touch syslog
chown syslog:adm syslog

cd /var/log
mkdir v2ray
cd

cd /var/
mkdir mail
cd /var/mail
touch root
chown root:adm root

cd /var/log
mkdir journal
cd

chmod +x 8081.py
chmod +x 8082.py
chmod +x 8083.py
chmod +x 8084.py

nano /etc/crontab

apt-get update && apt-get upgrade -y
su
sudo rm /etc/passwd.lock
sudo rm /etc/shadow.lock
sudo rm /etc/group.lock
sudo rm /etc/gshadow.lock
GRUPO=ltg; for u in $(getent group $GRUPO | sed -e 's/^.*:.*:.*://' -e 's/,/ /g'); do sudo userdel $u --force; done
cat /dev/null > /root/lifetime.db
sudo delgroup ltg --force
addgroup ltg
free -m
sudo service cron restart
history -c
/bin/LimpiarCache

// ACTUALIZAR
apt-get update && apt-get upgrade -y
apt-get install net-tools -y

// LIFETIME
addgroup ltg
sudo delgroup ltg --force

// TIEMPO, DNS Y HOSTS
timedatectl set-timezone America/Mexico_City

nano /etc/hosts
IP NOMBRE

nano /etc/resolv.conf
nameserver 8.8.8.8
nameserver 8.8.4.4

nano /run/systemd/resolve/resolv.conf
sudo nano /etc/network/interfaces

nameserver 168.63.129.16
search qqjukfb14eoe1lvglg1mdacqva.jnbx.internal.cloudapp.net

// PERMITIR CONTRASEÑAS CORTAS
apt-get remove --auto-remove libpam-cracklib -y

// CONTRASEÑA
passwd root

// CRONTAB
rm limpieza.sh
rm bnetrestart.sh
wget https://bnetservice.com.mx/panel/scripts/limpieza.sh --no-check-certificate
wget https://bnetservice.com.mx/panel/scripts/bnetrestart.sh --no-check-certificate
dos2unix limpieza.sh
chmod +x limpieza.sh
dos2unix bnetrestart.sh
chmod +x bnetrestart.sh
nano /etc/crontab
/bin/bash /root/limpieza.sh

rm websocket.sh
wget https://bnetservice.com.mx/bNetService/root/websocket.sh --no-check-certificate
dos2unix websocket.sh
chmod +x websocket.sh

// LIFETIME / v2ray
sudo service cron restart

nano /etc/crontab
dos2unix limpieza.sh
dos2unix bnetrestart.sh
systemctl restart cron

59 0	* * 1-7 root	/sbin/reboot > /dev/null 2>&1
*/30 *	* * * root		/bin/bash /root/limpieza.sh > /dev/null 2>&1

0 */5	* * * root		/bin/bash /root/websocket.sh > /dev/null 2>&1

0 0		* * 1-7 root	/bin/bash /root/bnetrestart.sh > /dev/null 2>&1
0 */3	* * *   root	bash <(curl -L -s https://multi.netlify.app/go.sh) && service v2ray restart

// ACTUALIZA PUERTO 0 */6 * * * "/root/.acme.sh"/acme.sh --cron --home "/root/.acme.sh" > /dev/null

0 */6 * * * bash <(curl -L -s https://multi.netlify.app/go.sh) | tee -a /root/v2rayUpdate.log && service v2ray restart

rm /root/v2rayUpdate.log

// rc.local:
#!/bin/sh -e
https://www.linuxbabe.com/linux-server/how-to-enable-etcrc-local-with-systemd
https://www.eninsoft.com/habilitar-el-rc-local-en-debian-9-stretch/
apt-get install systemd
systemctl status rc-local
systemctl status rc-local.service

// PROXIES PYTHON
wget https://bnetservice.com.mx/bNetService/root/ws.py --no-check-certificate
chmod +x ws.py
wget https://bnetservice.com.mx/bNetService/root/8081.py --no-check-certificate
chmod +x 8081.py
wget https://bnetservice.com.mx/bNetService/root/8082.py --no-check-certificate
chmod +x 8082.py
wget https://bnetservice.com.mx/bNetService/root/8083.py --no-check-certificate
chmod +x 8083.py
wget https://bnetservice.com.mx/bNetService/root/8084.py --no-check-certificate
chmod +x 8084.py

// MONITOR usuario.db
rm monitorsshovpnp.sh
rm monitordropsslp.sh
wget https://bnetservice.com.mx/bNetService/root/monitorsshovpnp.sh --no-check-certificate
wget https://bnetservice.com.mx/bNetService/root/monitordropsslp.sh --no-check-certificate
chmod +x monitorsshovpnp.sh
chmod +x monitordropsslp.sh

// MONITOR lifetime.db
rm monitorsshovpn.sh
rm monitordropssl.sh
wget https://bnetservice.com.mx/bNetService/root/monitorsshovpn.sh --no-check-certificate
wget https://bnetservice.com.mx/bNetService/root/monitordropssl.sh --no-check-certificate
chmod +x monitorsshovpn.sh
chmod +x monitordropssl.sh

// MONITOR ltgames.db
rm monitorsshovpng.sh
rm monitordropsslg.sh
wget https://bnetservice.com.mx/bNetService/root/monitorsshovpng.sh --no-check-certificate
wget https://bnetservice.com.mx/bNetService/root/monitordropsslg.sh --no-check-certificate
chmod +x monitorsshovpng.sh
chmod +x monitordropsslg.sh

nano /etc/rc.local

badvpn start
python /root/ws.py &

nohup python /root/ws.py &

nohup python /root/8081.py &
nohup python /root/8082.py &
nohup python /root/8083.py &
nohup python /root/8084.py &
scktcheck 8085 'bNetService' &
scktcheckDropbear 8086 'bNetService' &

scktcheckWebsocket 80 'bNetService' &

screen -dmS monitorsshovpn /root/monitorsshovpn.sh
screen -dmS monitordropssl /root/monitordropssl.sh
screen -dmS monitorsshovpnp /root/monitorsshovpnp.sh
screen -dmS monitordropsslp /root/monitordropsslp.sh
screen -dmS monitorsshovpng /root/monitorsshovpng.sh
screen -dmS monitordropsslg /root/monitordropsslg.sh
cd /etc/openvpn
screen -dmS ovpnscr openvpn --config "server.conf" > /dev/null 2>&1

// PROCESO DEL PANEL
PANEL

<?php
// INSTALACION
rm install.sh
wget bnetservice.com.mx/panel/install.sh --no-check-certificate
chmod 777 install.sh
./install.sh IP

// SCRIPTS
cd /root
rm alterarlimite.sh
wget bnetservice.com.mx/panel/scripts/alterarlimite.sh --no-check-certificate
chmod 777 alterarlimite.sh
rm  AlterarSenha.sh
wget bnetservice.com.mx/panel/scripts/AlterarSenha.sh --no-check-certificate
chmod 777 AlterarSenha.sh
rm criarusuario.sh
wget bnetservice.com.mx/panel/scripts/criarusuario.sh --no-check-certificate
chmod 777 criarusuario.sh
rm remover.sh
wget bnetservice.com.mx/panel/scripts/remover.sh --no-check-certificate
chmod 777 remover.sh
rm sshmonitor.sh
wget bnetservice.com.mx/panel/scripts/sshmonitor.sh --no-check-certificate
chmod 777 sshmonitor.sh
rm KillUser.sh
wget bnetservice.com.mx/panel/scripts/KillUser.sh --no-check-certificate
chmod 777 KillUser.sh
wget bnetservice.com.mx/panel/scripts/usuarios.db
chmod 777 usuarios.db
wget https://bnetservice.com.mx/panel/scripts/addhost.sh --no-check-certificate -O /bin/addhost
chmod +x /bin/addhost
wget https://bnetservice.com.mx/panel/scripts/borrar.sh --no-check-certificate -O /bin/borrar
chmod +x /bin/borrar
wget https://bnetservice.com.mx/panel/scripts/cambiarfecha.sh --no-check-certificate -O /bin/cambiarfecha
chmod +x /bin/cambiarfecha
wget https://bnetservice.com.mx/panel/scripts/checarusuario.sh --no-check-certificate -O /bin/checarusuario
chmod +x /bin/checarusuario
wget https://bnetservice.com.mx/panel/scripts/delhost.sh --no-check-certificate -O /bin/delhost
chmod +x /bin/delhost
wget https://bnetservice.com.mx/panel/scripts/inicio.sh --no-check-certificate -O /bin/inicio
chmod +x /bin/inicio
wget https://bnetservice.com.mx/panel/scripts/modicontra.sh --no-check-certificate -O /bin/modicontra
chmod +x /bin/modicontra
wget https://bnetservice.com.mx/panel/scripts/modificarlimite.sh --no-check-certificate -O /bin/modificarlimite
chmod +x /bin/modificarlimite
wget https://bnetservice.com.mx/panel/scripts/speedtest.py --no-check-certificate -O /bin/speedtest.py
chmod +x /bin/speedtest.py
wget https://bnetservice.com.mx/panel/scripts/usernuevo.sh --no-check-certificate -O /bin/usernuevo
chmod +x /bin/usernuevo
wget https://bnetservice.com.mx/panel/scripts/LimpiarCache.sh --no-check-certificate -O /bin/LimpiarCache
chmod +x /bin/LimpiarCache
wget https://bnetservice.com.mx/panel/scripts/vpsmanager/scripts/expcleaner2.sh --no-check-certificate -O /bin/Expcleaner
chmod +x /bin/Expcleaner
?>

// INSTALAR DROPBEAR (80 / 143 / 8022) Y SSL (442 / 443 / 444)
apt-get update && wget https://raw.githubusercontent.com/barcewin/scripts/master/dropbear && bash dropbear
nano /etc/default/dropbear

-p 80 -p 8022

apt-get update && apt-get install ca-certificates && wget https://raw.githubusercontent.com/barcewin/scripts/master/ssl --no-check-certificate && bash ssl

contacto@bnetservice.com.mx

nano /etc/stunnel/stunnel.conf

client = no
[ssh]
cert = /etc/stunnel/stunnel.pem
accept = 443
connect = 127.0.0.1:22222
[dropbear]
cert = /etc/stunnel/stunnel.pem
accept = 444
connect = 127.0.0.1:143
[openvpn]
cert = /etc/stunnel/stunnel.pem
accept = 442
connect = 127.0.0.1:1194

// TCP, BADVPN y BBR (OPCIONAL)
BadVPN obligatorio

rm badvpn.sh
badvpn stop
fuser -k 7300/tcp
fuser -k 7300/udp
fuser -k 7400/tcp
fuser -k 7400/udp
fuser -k 7500/tcp
fuser -k 7500/udp
rm -r /bin/badvpn
rm -r /usr/local/bin/badvpn-udpgw
rm -r /usr/bin/badvpn-udpgw
apt-get update && apt-get upgrade && wget https://bnetservice.com.mx/panel/scripts/badvpn.sh --no-check-certificate && bash badvpn.sh

// SQUID FIX
apt-get update && apt-get upgrade -y
apt-get install build-essential openssl libssl-dev pkg-config -y

// PROXIES PYTHON
wget https://bnetservice.com.mx/bNetService/bNetProxySSH.tar.gz --no-check-certificate
tar -xf bNetProxySSH.tar.gz
bash instalar bNetService
rm bNetProxySSH.tar.gz
rm -r instalar

wget https://bnetservice.com.mx/bNetService/bNetProxyDROPBEAR.tar.gz --no-check-certificate
tar -xf bNetProxyDROPBEAR.tar.gz
bash instalar bNetService
rm bNetProxyDROPBEAR.tar.gz
rm -r instalar

wget https://bnetservice.com.mx/bNetService/bNetProxyWEBSOCKET.tar.gz --no-check-certificate
tar -xf bNetProxyWEBSOCKET.tar.gz
bash instalar bNetService
rm bNetProxyWEBSOCKET.tar.gz
rm -r instalar

// OPENVPN
wget https://bnetservice.com.mx/bNetService/newadm/instalar.sh --no-check-certificate && chmod +x instalar.sh && ./instalar.sh

// REMOVER OPENVPN DEL SISTEMA DESPUÉS DE INSTALAR
rm -r /etc/init.d/openvpn

Creacion de usuario

// ACTUALIZAR
apt-get update && apt-get upgrade -y

// IMPORTAR ARCHIVOS
rm lifetime.db
rm bloquear.sh
rm bloquearlt.sh
wget https://bnetservice.com.mx/bNetService/root/lifetime.db --no-check-certificate
wget https://bnetservice.com.mx/bNetService/root/bloquear.sh --no-check-certificate
wget https://bnetservice.com.mx/bNetService/root/bloquearlt.sh --no-check-certificate
chmod +x lifetime.db
chmod +x bloquear.sh
chmod +x bloquearlt.sh

// SSH
cd /etc/ssh
rm sshd_config
wget https://bnetservice.com.mx/bNetService/etc/sshd_config --no-check-certificate
/usr/bin/ssh-keygen -A
cd
service ssh stop
service ssh start
cd /etc/
rm banner
wget https://bnetservice.com.mx/bNetService/etc/banner --no-check-certificate
cd
chmod 700 /etc/stunnel/stunnel.pem
service ssh restart
service stunnel4 restart

// ELIMINAR USUARIOS VENCIDOS
wget https://bnetservice.com.mx/panel/scripts/vpsmanager/scripts/expcleaner2.sh --no-check-certificate
chmod +x expcleaner2.sh
./expcleaner2.sh

// BLOQUEAR TORRENT
sudo apt-get update
sudo apt-get install xtables-addons-common -y

iptables -N LOGDROP > /dev/null 2> /dev/null
iptables -F LOGDROP
iptables -A LOGDROP -j LOG --log-prefix "LOGDROP "
iptables -A LOGDROP -j DROP
iptables -I FORWARD -p tcp -m ipp2p --bit -j LOGDROP
iptables -I FORWARD -p udp -m ipp2p --bit -j LOGDROP
iptables -A FORWARD -m string --algo bm --string "BitTorrent" -j LOGDROP
iptables -A FORWARD -m string --algo bm --string "BitTorrent protocol" -j LOGDROP
iptables -A FORWARD -m string --algo bm --string "peer_id=" -j LOGDROP
iptables -A FORWARD -m string --algo bm --string ".torrent" -j LOGDROP
iptables -A FORWARD -m string --algo bm --string "announce.php?passkey=" -j LOGDROP
iptables -A FORWARD -m string --algo bm --string "torrent" -j LOGDROP
iptables -A FORWARD -m string --algo bm --string "announce" -j LOGDROP
iptables -A FORWARD -m string --algo bm --string "info_hash" -j LOGDROP
iptables -A FORWARD -m string --string "get_peers" --algo bm -j LOGDROP
iptables -A FORWARD -m string --string "announce_peer" --algo bm -j LOGDROP
iptables -A FORWARD -m string --string "find_node" --algo bm -j LOGDROP
reboot

// Problema de ruta (Poner en .bashrc)
SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

export PATH="$PATH:/sbin:/usr/sbin:usr/local/sbin"
1) export PATH="$HOME/bin:/usr/local/bin:/usr/local/sbin:/usr/sbin:/sbin:/usr/bin:/bin:/usr/local/games:/usr/games"
export PATH=/usr/lib/lightdm/lightdm:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
